# Tasks: enhance-natal-chart-settings

## Implementation Checklist

### Phase 1: 地名检索优化
- [x] 创建本地中国城市数据（60个常用城市）
- [x] 实现本地优先匹配逻辑
- [x] 保留 Nominatim API 作为备选
- [x] 优化搜索防抖时间（300ms → 200ms）

### Phase 2: 经纬度显示
- [x] 在城市输入框下方添加经纬度显示区域
- [x] 格式化经纬度显示（度数 + 方向）
- [x] 添加经纬度手动编辑功能
- [x] 经纬度变化时触发星盘更新

### Phase 3: 设置弹窗 UI
- [x] 从左侧面板移除天体选择区域
- [x] 在星盘区域添加"设置"按钮
- [x] 创建模态弹窗组件
- [x] 实现标签页切换（天体/相位/容许度）

### Phase 4: 天体选择功能
- [x] 在弹窗中实现天体复选框
- [x] 迁移现有天体选择逻辑
- [x] 保持 localStorage 持久化

### Phase 5: 相位选择功能
- [x] 定义相位数据结构（名称、角度、默认状态）
- [x] 实现相位复选框 UI
- [x] 更新星盘渲染逻辑（根据选择过滤相位）
- [x] 添加相位选择到 localStorage

### Phase 6: 容许度设置
- [x] 为每种相位添加容许度输入/滑块
- [x] 实现容许度实时更新
- [x] 添加容许度设置到 localStorage
- [x] 添加"恢复默认"按钮

### Validation
- [x] 测试本地城市搜索速度（应 < 50ms）
- [x] 测试 API 降级逻辑
- [x] 测试经纬度手动编辑
- [x] 测试设置弹窗响应式布局
- [x] 测试所有设置的持久化

## Dependencies

```
Phase 1 (地名检索优化)
    ↓
Phase 2 (经纬度显示)

Phase 3 (设置弹窗 UI)
    ↓
Phase 4 (天体选择) → Phase 5 (相位选择) → Phase 6 (容许度设置)
```

## Acceptance Criteria

1. 搜索常用中国城市时响应时间 < 100ms ✓
2. 页面显示当前选择位置的经纬度 ✓
3. 可以手动编辑经纬度 ✓
4. 天体选择和相位设置在弹窗中统一管理 ✓
5. 可以单独选择要显示的相位类型 ✓
6. 可以为每种相位设置不同的容许度 ✓
7. 所有设置在刷新后保持 ✓
